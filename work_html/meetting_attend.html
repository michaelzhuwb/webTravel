<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>智能在线招标系统</title>

	<!-- <link rel="stylesheet" type="text/css" href="michealMedia/css/jquery.dataTables.min.css" /> -->
    <!-- <link rel="stylesheet" type="text/css" href="michealMedia/css/dataTables.bootstrap.css" /> -->
    <link rel="stylesheet" type="text/css" href="michealMedia/bootstrap.min.css" />

	<!-- <link rel="stylesheet" type="text/css" href="michealMedia/css/jquery.dataTables.css" /> -->
    

    <script type="text/javascript" src="michealMedia/jquery-3.4.1.min.js"></script>
    <!-- <script src="michealMedia/template.js"></script> -->
    <script type="text/javascript" src="michealMedia/jquery.tmpl.min.js"></script>
    <script type="text/javascript" src="michealMedia/jquery.dataTables.min.js"></script>  
    <!-- <script src="michealMedia/js/dataTables.bootstrap.min.js"></script>   -->
    <script type="text/javascript" src="basicMedia/js/personalJS/wwlogin.min.js"></script>
    
    <!-- <script type="text/javascript" src="michealMedia/micheal_ajax.js"></script>   -->

<script type="text/javascript" src="michealMedia/bootstrap.min.js"></script>
<script type="text/javascript" src="testF/michealMedia/dist/js/bootstrap.min.js"></script>  

<script type="text/javascript" src="testF/micheal_ajax.js?v=1.3452"></script>  



    

    <!--micheal-->

</head>
<body style="overflow-y:scroll;overflow-x:auto; ">
    <div class="backstretch" style="left: 0px; top: 0px; overflow: hidden; margin: 0px; padding: 0px; height: 645px; width: 1903px; z-index: -999999; position: fixed;">
            <img style="overflow: hidden;position: absolute; margin: 0px; padding: 0px; border: medium none; width: 1903px; height: 290px; max-width: none; z-index: -999999; left: 0px; top: -212.719px;" src="media/image/bg/20170620_bg2.jpg">
            </div>
    <div id="content" >
        <!-- 招标开标头部 -->
        <div id='head_template'></div>
        

        <div class="hidden totalPrice_Sort list-group-item list-group-item-success" style="position:relative;top:60px">
            <div class="row">
                <div class="col-md-6">总价排名</div>
                <div class="col-md-2">

                        <div class="dropdown">
                                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                  <span id="brand_show_name">品牌筛选</span>
                                  <span class="caret"></span>
                                </button>
                                <ul id="brandsel" class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                </ul>
                        </div>
                </div>
                <div class="col-md-2">
                    <button type="button" id='zone' class="btn btn-primary">区域排名</button>
                </div>
                <div class="col-md-2">
                    <button type="button" id='sign-in' class="btn btn-primary">签到</button>
                </div>
            </div>
            
            <div id="modal_zone">
            </div>

            <div class="modal" id="myModal" tabindex="-1" role="dialog" style="">
                <div class="modal-dialog" role="document" style="width:80%">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">区域排名</h4>
                        </div>
                        <div class="modal-body">
                            <table id="zone_sort" class="display table"  cellpadding='0' cellspacing='0' style="width:100%;color:black">

                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        </div>
                    </div>  
                </div>
            </div>
        </div>
        <div id='totalPrice_Sort' class="" style="position:relative;top:80px"></div>

        <div class="hidden materials_Bill list-group-item list-group-item-warning" style="position:relative;top:80px">材料清单</li></div>
        <div id='materials_Bill' class="" style="position:relative;top:100px"></div>
        
        <div class="nav-page hidden" style="align-content: center;text-align: center;position:relative;top:100px">
            <nav class="" aria-label="Page navigation" >
                <ul id = "nav-page" class="pagination">
                </ul>
                <button id="result_up" type="button" class="btn btn-success">评标结果登记</button>
              </nav>
        </div>



        <div id='bid_Manage' class="" style="position:relative;top:80px" ></div>
    </div>
                

               <!-- <div id="data_table">
                <table class="table table-bordered">
                    <tr>
                        {{each  m_header}}
                            <td>
                                ${$value}
                            </td>
                        {{/each}}
                    </tr>
                    {{each m}}
                </table>

            </div> -->
<!-- /** 模态框 区域排名 -->
<script id='modal_zoneT' type="text/x-jquery-tmpl" >
<div class="modal" id="myModal" tabindex="-1" role="dialog" >
    <div class="modal-dialog modal-lg" role="document"  style="width:1900px">
        <div class="modal-content" style="width:100%;">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">区域排名</h4>
        </div>
        <div class="modal-body" style="width:100%">
            <table id="zone_sort" class="display table"  cellpadding='0' cellspacing='0' style="width:100%"></table>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
        </div>
        </div>
    </div>
    </div>
</script>

<!-- 头部页面 -->
<script id='headTemplate' type="text/x-jquery-tmpl">
    <div class="container-fluid" style="">
        <div style="">
          <nav class="navbar navbar-default navbar-fixed-top" style="background-color:transparent !important;">
                <div class="container-fluid" style="">
                    <div class=" navbar-header"  style="background-color:transparent !important;">
                            <a class="navbar-brand" href="#">
                            <img  style="" class="brand media-object" src="michealMedia/images/logo_by.png" alt="Brand">
                            </a>
                        <p style="color: white;font-size:30px;opacity:1"class="brandDcp navbar-text"><strong>&nbsp;</strong>&nbsp;&nbsp;智能在线招标系统</p>

                    </div>
                    <div class="collapse navbar-collapse" style="margin-right:20px">
                        <p style="color: white;font-size:30px;" class="brandDcp navbar-text navbar-right"><strong>&nbsp;</strong>&nbsp;&nbsp;开标会议签到</p>
                    </div>
            </nav>
        </div>
    </div>

    <div style="position:relative;top:80px">
            <table class="table" style="width=100% !important">
                    <tr>
                        <td class="type-info">
                            <p id="proj_name">招标项目：</p>
                        </td>
                        <td>
                            &nbsp;
                        </td>
                        <td class="type-info" style="text-align:right;" >
                            <p class="right" id="mat_name">招标材料：</p>
                        </td>
                    </tr>
                </table>
        </div>
</script>
<!-- 总价排名 -->
<script id='totalPriceSort' type="text/x-jquery-tmpl" >
        <div class="one-part">
            <table width="100%">
               
                <tr>
                    <td width="10%" style="text-align:center">
                        <b>第${rank}名</b>
                    </td>
                    <td width="" >

                                  <h4 class="list-group-item-heading">${sup_name}
                            
                                        <span class="m_brand_name">
                                            (${brand})
                                        </span>
                                </h4>
                                  <p class="list-group-item-text">${amount}元</p>
                    </td>
                    <td width="40%" >
                            <div class="progress" style="height:50px">
                                    <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: ${floating_percentage}%;"  height="1000px">
                                        <!-- <span class="sr-only">${progress} %进度条</span> -->
                                    </div>
                            </div>
                    </td>
                    <td width="10%">
                            ${floating_percentage} %
                    </td>
                    <td width="10%">
                        <button  type="button" class="change btn btn-primary" sup_id="${sup_id}" >修改</button>
                        <button  type="button" class="start_yb btn btn-primary" sup_id="${sup_id}" brand="${brand}" >开始议标</button>
                    </td>
                </tr>
            </table>
        </div>
        <!-- </div> -->

</script>
<!-- 材料清单 -->
<script id="materialsBill" type="text/x-jquery-tmpl">
    <div class="two-part">
            <div class='t-title'></div>
            <div class="tender-info hidden" >投标单价相关信息</div>
            <table id="materialsBillExample" class="display  table-bordered example" width="100%" cellpadding='0' cellspacing='0' style="font-size:21px;min-width:100%;text-align:center">

                <!-- <tfoot>
                    <th style="text-align:center">合计</th>
                    <th>产品</th>
                    <th>数据来源</th>
                    <th>数据类型</th>
                </tfoot> -->
                
            </table>
    </div>
</script>
<!-- 签到页面 -->
<script id='bidManage' type="text/x-jquery-tmpl">
    <div class='bidManage_left' style="">
        <!-- <table class="table" style="width=100% !important">
            <tr>
                <td class="type-info">
                    <small>招标项目<small>
                </td>
                <td>
                    &nbsp;
                </td>
                <td class="type-info" style="text-align:right;" >
                    <small class="right">招标材料：<p id="mat_name">123</p></small>
                </td>
            </tr>
        </table> -->
        <table class="table" style="width=100% !important">
            <tr style="border-top:none">
                <td width="50%" style="border-top:none">
                    <table class="table" style="border-top:none">
                        <tr>
                            <td style="border-top:none">
                                <div id="kb_time" style="display:inline;">开标时间：</div> 
                                <div style="display:inline;float:right"><button class="btn btn-primary" id="qrcodes" type="button" style="align:right;margin-right:30px" >迟到乐捐</button></div>   
                                <hr style="border:1px solid">
                            </td>
                        </tr>
                        <tr>
                            <td style="border-top:none">
                                <table id="bidManageExample" class="display table"  cellpadding='0' cellspacing='0'></table>
                            </td>
                        </tr>
                    </table>
                </td>
                <td style="border-top:none">
                        <!-- <div id='later_qr_code' class='hidden' style="margin-left:100px">
                                <img src="michealMedia/images/QRcode.jpg"  width="700px">
                        </div> -->
                </td>
                <td width="40%" style="border-top:none;text-align:center">
                    <table class="qywx_attend" >
                    <tr><td>
                    <p class="" style="font-size:24px;" >请所有<span style="color:red">参会人员</span>用企业微信进行扫码签到</p>
                    </td></tr>
                    <tr><td style="text-align:center">
                        <!-- <img src="michealMedia/images/QRcode.png"> -->
                        <div id="qr_code">
                        </div>
                        <!-- <div id='later_qr_code' class='hidden'>
                                <img src="michealMedia/images/QRcode.jpg" width="800">
                        </div> -->
                    </td></tr>
                    <tr><td>
                        签到成员：<div style="display:inline-block;" id="sign_users">5人<div>
                    </td></tr>
                    <tr><td>
                        <button id="kaibiao" style="margin-top:10px;padding:10px 100px" type="button" class="btn btn-success" disabled>签到完成,一键开标</button>
                    </td></tr>
                    </table>
                    <div id='later_qr_code' class='hidden' style="margin-left:10px">
                            <img src="michealMedia/images/QRcode.jpg"  width="680px">
                    </div>

                </td>
            </tr>
        </table>
    </div>
<!-- </div> -->
</script>



<script type='text/javascript'>
    Mr.saveSesstionStorage('zone_sort','false')


    $('#zone').click(function(){
        // alert('asd')
        // $('#modal_zone').empty()
        // $('#modal_zoneT').tmpl([{}]).appendTo('#modal_zone')
        // $('#myModal').modal('toggle')
        if (Mr.sstorage['zone_sort']=='false'){
            var _zone_sort = function(res)
            {
                
                header = []
                for (var i=0;i<res['header'][0].length;i++)
                    {
                        header.push({'title':res['header'][0][i]})
                    }
                console.log(res['header'][0])
                jQuery('#zone_sort').dataTable({
                                        data: res['rows'],
                                        info: false,     //底部信息
                                        ordering: true,    // 禁止排序
                                        paging: false,      // 禁止分页
                                        bFilter: false,     // 禁止搜索
                                        // "sScrollY" : 80, //DataTables的高  
                                            // "sScrollX" : 820, //DataTables的宽  
                                        // bScrollCollapse : false, //是否开启DataTables的高度自适应，当数据条数不够分页数据条数的时候，插件高度是否随数据条数而改变
                                        "columns": header,
                                        "lengthMenu": [3],      //每页显示多少数据
                                        "lengthChange": false,   //选择每页显示多少条数据，下拉选项       

                                        zeroRecords: "没有内容",
                                        // "sScrollX": "100%",
                                        "oLanguage": { //国际化配置  
                                                "sProcessing" : "正在获取数据，请稍后...",    
                                                "sLengthMenu" : "显示 _MENU_ 条",    
                                                "sZeroRecords" : "暂时没有人员签到",    
                                                "sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
                                                "sInfoEmpty" : "记录数为0",    
                                                "sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
                                                "sInfoPostFix" : "",    
                                                "sSearch" : "搜索",    
                                                "sUrl" : "",    
                                                "oPaginate": {    
                                                    "sFirst" : "第一页",    
                                                    "sPrevious" : "上一页",    
                                                    "sNext" : "下一页",    
                                                    "sLast" : "最后一页"    
                                                }  
                                            },  
                                    });
                Mr.saveSesstionStorage('zone_sort','true')
                $('#myModal').modal('toggle')

        }
            var url = 'https://lw.szby.cn/data/bid/getZoneList/'
            var param = {
                        'pk':45
                    }
            Mr.requestData(url,param,_zone_sort)
        }
        else
            $('#myModal').modal('toggle')
    })


    var head=[];
    var _temp=[];
    var _heads=[];
    //静态请求数据
    $.ajax({
            //请求方式为get
            type:"GET",
            //json文件位置
            url:"./michealMedia/configBase/baseinfo.json",
            //返回数据格式为json
            dataType: "json",
            async:false,    // 同步
            complete:function(res){
                result=eval("("+res.responseText+")");
                // console.log(result)
                head = result['head']
                _heads.push(head)
                // _heads = head.concat(result['qrcode'])
                _heads = (result['qrcode'])
                console.log('heads')
                console.log(_heads)
                for (var i=0;i<result['info'].length;i++){
                    _temp.push(result['info'][i])
                }
            }
         });
    console.log(head)
    data = [{logoImgAddr:'./michealMedia/images/logo.png',"DscribeInfo":'供应商服务平台'}]   
 
        // li_content =[['第一行','投标公司','图表','比例','开始议标'],['第二行','投标公司','图表'],['第三行','投标公司','图表']] //测试

        $('#headTemplate').tmpl(head).appendTo('#head_template')     
        // $('#totalPriceSort').tmpl([{rank:1},{price:2},{price:2}]).appendTo('#totalPrice_Sort')  // 一键开标后的表单
        // $('#materialsBill').tmpl(head).appendTo('#materials_Bill')                              //一键开标后的表单 
        $('#bidManage').tmpl(head).appendTo('#bid_Manage')                              // 签到,一件开标页面

         // 同页面下不同显示


$(document).ready(function() {
    // 迟到乐捐
    $('#qrcodes').mouseover(function(){
        $('#later_qr_code').removeClass('hidden')
        $('.qywx_attend').addClass('hidden')
        // $('#qr_code').addClass('hidden')
    })
    $('#qrcodes').mouseleave(function(){
        // $('#qrcode').addClass('hidden')
        $('#later_qr_code').addClass('hidden')
        $('.qywx_attend').removeClass('hidden')
        // $('#qr_code').removeClass('hidden')

    })


// var parms = window.location.search;
var _t = window.location.search.substring(1).replace('#','');
    x = _t.split('&')
    _parm = Object()
    for(var i=0;i<x.length;i++)
    {
        var _t = x[i].split('=')
        if (_t.length==1)
            _parm[_t[-1]] = ''
        else
            _parm[_t[0]]= _t[1]
    }

//if (_parm['code']){
if (1==2){
    console.log('参数')
    console.log(_parm)
    $.ajax({
        type:"POST",
        url:"https://lw.szby.cn/data/bid/userSign/",
        data:_parm,
        dataType: "json",
        // async:false,    // 同步
        complete:function(res,status){
            _result=eval("("+res.responseText+")");
            if (_result['errcode']!=0)
                {
                    alert(_result['errmsg'])
            }
        },
            success:function(res){
                var data_sets = []
                var data = res['data']['user_list']
                for (var i=0;i<data.length;i++)
                {   
                    var data_set = []
                    _data = data[i]
                    for (var key in _data)
                        {
                            data_set.push(_data['usr_name'])
                            data_set.push(_data['dept_name']) // 部门
                            data_set.push(_data['sign_time']) // 
                            if (_data['late_minute']<=0)
                                data_set.push('123<0')
                            else
                                data_set.push(_data['late_minute'])


                        }
                        data_sets.push(data_set)

                }
                jQuery('#bidManageExample').dataTable( {
                                    data: data_sets,
                                    info: false,     //底部信息
                                    ordering: false,    // 禁止排序
                                    paging: false,      // 禁止分页
                                    bFilter: false,     // 禁止搜索
                                    // "sScrollY" : 80, //DataTables的高  
                                        // "sScrollX" : 820, //DataTables的宽  
                                    // bScrollCollapse : false, //是否开启DataTables的高度自适应，当数据条数不够分页数据条数的时候，插件高度是否随数据条数而改变
                                    "columns": [
                                        // { "title": "<span class='f-titles'>总价排名</span>" },
                                        { "title": "姓名" },
                                        { "title": "部门" },
                                        { "title": "签到时间" },
                                        { "title": "迟到" },
                                        // { "title": "型号"}
                                    ],
                                    "lengthMenu": [3],      //每页显示多少数据
                                    "lengthChange": false,   //选择每页显示多少条数据，下拉选项       

                                    zeroRecords: "没有内容",
                                    // "sScrollX": "100%",
                                    "oLanguage": { //国际化配置  
                                            "sProcessing" : "正在获取数据，请稍后...",    
                                            "sLengthMenu" : "显示 _MENU_ 条",    
                                            "sZeroRecords" : "暂时没有人员签到",    
                                            "sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
                                            "sInfoEmpty" : "记录数为0",    
                                            "sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
                                            "sInfoPostFix" : "",    
                                            "sSearch" : "搜索",    
                                            "sUrl" : "",    
                                            "oPaginate": {    
                                                "sFirst" : "第一页",    
                                                "sPrevious" : "上一页",    
                                                "sNext" : "下一页",    
                                                "sLast" : "最后一页"    
                                            }  
                                        },  
                                });
            }
    })
} // if
else{
// 签到页面表格
    $.ajax({
            type:"POST",
            url:"https://lw.szby.cn/data/bid/userSign/",
            data:_parm,
            dataType: "json",
            // async:false,    // 同步
            complete:function(res,status){
                _result=eval("("+res.responseText+")");
                if (_result['errcode']!=0)
                    {
                        alert(_result['errmsg'])
                }
            },
                success:function(res){
                    var data_sets = []
                    var data = res['data']['user_list']
                    var sign_count = 0;
                    for (var i=0;i<data.length;i++)
                    {   
                        var data_set = []
                        _data = data[i]
                        if (_data['sign_time']) sign_count++;
                        data_set.push(_data['usr_name'])
                        data_set.push(_data['dept_name']) // 部门
                        data_set.push(_data['sign_time']) // 
                        if (_data['late_minute']<=0)
                            data_set.push('')
                        else
                            data_set.push(_data['late_minute'])
                        data_sets.push(data_set)
                    }
                    $("#proj_name").html("招标项目："+res['data']['proj_name']);
                    $("#mat_name").html("招标材料："+res['data']['zbfw']);
                    $("#kb_time").html("开标时间："+res['data']['kb_time']);
                    $("#sign_users").html(sign_count+"人");
                    if (sign_count<3){
                        $("#sign_users").css("color","red");
                        $("#kaibiao").attr("disabled",true); 
                    }
                    else{
                        $("#sign_users").css("color","green");
                        $("#kaibiao").attr("disabled",false); 
                    }
                    jQuery('#bidManageExample').dataTable( {
                                        data: data_sets,
                                        info: false,     //底部信息
                                        ordering: false,    // 禁止排序
                                        paging: false,      // 禁止分页
                                        bFilter: false,     // 禁止搜索
                                        // "sScrollY" : 80, //DataTables的高  
                                            // "sScrollX" : 820, //DataTables的宽  
                                        // bScrollCollapse : false, //是否开启DataTables的高度自适应，当数据条数不够分页数据条数的时候，插件高度是否随数据条数而改变
                                        "columns": [
                                            // { "title": "<span class='f-titles'>总价排名</span>" },
                                            { "title": "姓名" },
                                            { "title": "部门" },
                                            { "title": "签到时间" },
                                            { "title": "迟到" },
                                            // { "title": "型号"}
                                        ],
                                        "lengthMenu": [3],      //每页显示多少数据
                                        "lengthChange": false,   //选择每页显示多少条数据，下拉选项       

                                        zeroRecords: "没有内容",
                                        // "sScrollX": "100%",
                                        "oLanguage": { //国际化配置  
                                                "sProcessing" : "正在获取数据，请稍后...",    
                                                "sLengthMenu" : "显示 _MENU_ 条",    
                                                "sZeroRecords" : "暂时没有人员签到",    
                                                "sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
                                                "sInfoEmpty" : "记录数为0",    
                                                "sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
                                                "sInfoPostFix" : "",    
                                                "sSearch" : "搜索",    
                                                "sUrl" : "",    
                                                "oPaginate": {    
                                                    "sFirst" : "第一页",    
                                                    "sPrevious" : "上一页",    
                                                    "sNext" : "下一页",    
                                                    "sLast" : "最后一页"    
                                                }  
                                            },  
                                    });
                }
        })
}

// 企业微信二维码
window.WwLogin({
            "id" : "qr_code",  
            "appid" : "wxc6d740ece61b7ec1",
            "agentid" : "1000007",
            "redirect_uri" :encodeURI("https://lw.szby.cn/meetting_attend.html?pk="+_parm['pk']+''),
            "state" : (Mr.getParamers()['state'])?(Mr.getParamers()['state']):sstorage['AccessToken']+"",
            "href" : "",
    });


// 一键开标后的表单

Mr.saveSesstionStorage('ppyq','')

kaibiao = function(res){

    super_list = res['data']['sup_list']
    // alert(res['data']['ppyq'])
    if (res['data']['ppyq']==2)
        {
            Mr.saveSesstionStorage('ppyq','false')
        }
        
    var data_sets = res['data']['mat_list']['rows']
    var header = []
    var _head = res['data']['mat_list']['header']
    _temp_n = _head.indexOf('数量')

    for (var i=0;i<_head.length;i++)
        {
            if (i>_temp_n)
                header.push({'title':_head[i],'sClass':'unit_price'+(i+res['pageNo'])+''})
            else
                header.push({'title':_head[i]})
        }

    // 添加品牌筛选
    brand = $('#brandsel')
    brand.empty()
    for (var i=0;i<res['brand'].length;i++)
    {           label = res['brand'][i]['label']
                var li = document.createElement('li')
                li.className='brand_sx'
                li.innerHTML =  '<a>'+label+'</a>'
                brand.append(li)
    }

    brand.append($('<li role="separator" class="divider"></li>'))
    brand.append($('<li class="brand_sx"><a class="all">所有</a></li>'))

// 添加选择事件
    $('.brand_sx a').click(function(){
            $('.brand_show_name').html($(this).html())
            Mr.saveSesstionStorage('brand_param',$(this).html())
            if($(this).html()!='所有')
                brand = Mr.sstorage['brand_param']
            else
                brand = ''
            parmer = {
                'pk':Mr.getParamers()['pk'],
                'AccessToken':Mr.sstorage['AccessToken'],
                'brand':brand
            }
            Mr.requestData('https://lw.szby.cn/data/bid/openBidData_yb/',parmer,kaibiao)
            Mr.saveSesstionStorage('brand_param','')
        })


    Mr.saveSesstionStorage('pageno',res['pageNo'])
    // 增加排名
    for (var i=0;i<super_list.length;i++){
        super_list[i]['rank'] = ((parseInt(Mr.sstorage['pageno'])?parseInt(Mr.sstorage['pageno']):1)-1)*5+1+i
    
        }
    Mr.saveSesstionStorage('super_list',JSON.stringify(super_list))
    Mr.saveSesstionStorage('header',JSON.stringify(header))
    Mr.saveSesstionStorage('data_sets',JSON.stringify(data_sets))
    Mr.saveSesstionStorage('max_page',res['totalPage'])

    
    // 展示分页
    page = $('#nav-page')
    page.empty()
    page.append('<li><a value="prev" class="click_page_num" href="###" onclick="page_fun(this);" aria-label="Next"><span aria-hidden="true">&laquo;</span></a></li>')
    for(var i=0;i<res['totalPage'];i++)
        {
            var li = document.createElement('li')
            if (!i)
                li.className='active'
            li.innerHTML = '<a class="click_page_num" onclick="page_fun(this);" value='+(i+1)+'>'+(i+1)+'</a>'
            page.append(li)
        }
    page.append('<li><a class="click_page_num" href="###" onclick="page_fun(this);" value="next" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>')
    

    if (Mr.sstorage['is_click_bid'])
    {
        _kb_click()
    }
    };

parmer = {
    'pk':Mr.getParamers()['pk'],
    'AccessToken':Mr.sstorage['AccessToken'],
    'accesstokenNew':Mr.getParamers()['state']
}


if (!Mr.lsstorage['AccessToken'] && Mr.sstorage['AccessToken']!=undefined && Mr.sstorage['AccessToken']!='')
    
{
    console.log(Mr.sstorage['AccessToken'])

    Mr.saveLocalStorage('AccessToken',Mr.sstorage['AccessToken'])
}

if (Mr.sstorage['brand_param'])
    $('.brand_show_name').html(Mr.sstorage['brand_param'])

if (Mr.lsstorage['AccessToken'])
    parmer['AccessToken'] = Mr.lsstorage['AccessToken']


if (Mr.getParamers()['state']=='')
    delete parmer['accesstokenNew']
Mr.requestData('https://lw.szby.cn/data/bid/openBidData_yb/',parmer,kaibiao)

$('#result_up').click(function(){
    location.href= ('commonDataTable.html?menu_id=1604&step=4&mode=upd&pk='+Mr.getParamers()['pk']+'')
})



_kb_click = function(){
        $('.materials_Bill,.totalPrice_Sort,.nav-page').removeClass('hidden'); // 开标的界面
        $('#bid_Manage').addClass('hidden') // 签到界面

        super_list = JSON.parse(Mr.sstorage['super_list'])
        data_sets = JSON.parse(Mr.sstorage['data_sets'])
        header = JSON.parse(Mr.sstorage['header'])
        start_num = -1
        for (var key in header)
            if (header[key]['title'].indexOf('数量')!=-1)
                {start_num = key;break;}
        end_num = header.length

        for(var i=0;i<data_sets.length;i++){
            _data = data_sets[i]
            for (var j=0;j<_data.length;j++)
            {   
                
                m_min = _data[_data.length-1].split('|')
                m_min = parseFloat(m_min[m_min.length-1]) // 最小值
                var _temp = ''
                if (start_num<j&&j<_data.length-1)  //  属于每个品牌字段中
                {
                    m_data = _data[j].split('|')
                    for (var _i=0;_i<m_data.length;_i++)
                        if (m_data[_i]==m_min)
                            _temp +='<span class="yb_'+_i+'" style="background:green;color:white">'+m_data[_i]+'</span>'+Mr.Nbsp_Number(5)
                        else
                            _temp +='<span class="yb_'+_i+'">'+m_data[_i]+'</span>'+Mr.Nbsp_Number(5)
                    data_sets[i][j] = _temp
                }
            }
        }
        $('#totalPrice_Sort').empty()
        $('#materials_Bill').empty()
        $('#totalPriceSort').tmpl(super_list).appendTo('#totalPrice_Sort')  // 一键开标后的表单
        $('#materialsBill').tmpl(head).appendTo('#materials_Bill')          //一键开标后的表单 
        if (Mr.sstorage['ppyq']=='false')
            $('.m_brand_name').addClass('hidden')

        // 修改
        $('.change').click(function(){
            sup_id = $(this).attr('sup_id')
            pk = Mr.getParamers()['pk']
            url = "src_bidManage.html?pk="+pk+'&sup_id='+sup_id+''
            // Mr.requestData('mat_call_bid.html')
            location.href=(url)
        })

        $('.start_yb').click(function(){
            sup_id = $(this).attr('sup_id')
            brand = $(this).attr('brand')
            pk = Mr.getParamers()['pk']
            if (Mr.sstorage['ppyq']=='false')
                brand = ''
            url = "mat_call_bid.html?pk="+pk+'&brand='+brand+'&sup_id='+sup_id+''
            // Mr.requestData('mat_call_bid.html')
            location.href=(url)

        })


        _dab = jQuery('#materialsBillExample').dataTable( {
                data: data_sets,
                info: false,     //底部信息
                ordering: false,    // 禁止排序
                paging: false,      // 禁止分页

                bFilter: false,     // 禁止搜索
                "sScrollY" : "100%", //DataTables的高  
                    // "sScrollX" : 820, //DataTables的宽  
                bScrollCollapse : false, //是否开启DataTables的高度自适应，当数据条数不够分页数据条数的时候，插件高度是否随数据条数而改变
                "columns": header,

                "lengthMenu": [-1],      //每页显示多少数据
                "lengthChange": false,   //选择每页显示多少条数据，下拉选项       

                zeroRecords: "没有内容",
                "sScrollX": "100%",
                "oLanguage": { //国际化配置  
                        "sProcessing" : "正在获取数据，请稍后...",    
                        "sLengthMenu" : "显示 _MENU_ 条",    
                        "sZeroRecords" : "没有您要搜索的内容",    
                        "sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
                        "sInfoEmpty" : "记录数为0",    
                        "sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
                        "sInfoPostFix" : "",    
                        "sSearch" : "搜索",    
                        "sUrl" : "",    
                        "oPaginate": {    
                            "sFirst" : "第一页",    
                            "sPrevious" : "上一页",    
                            "sNext" : "下一页",    
                            "sLast" : "最后一页"    
                        }  
                    },
   
})
    _dab = $('#materialsBillExample').DataTable()
    
    // 合计
    // m_nums =header[key]['title'].indexOf('数量')
    m_nums = 3 // 数量位置  
    total = []
    total1 = []
    total.push('<div class="sum_num">议标前合计</div>')
    total1.push('<div class="sum_num">议标后合计</div>')
    _pageno = parseInt(Mr.sstorage['pageno'])
    for (var i=1;i<end_num;i++){
            if (i>start_num)
                {
                    x = $('.unit_price'+(i+_pageno)+' .yb_0')
                    x1 = $('.unit_price'+(i+_pageno)+' .yb_1')       // 议标后
                    // console.log(x)
                    var _temps = 0
                    var _temps1 = 0
                    for (var _i=0;_i<x.length;_i++)
                        {
                             __x = $(x[_i]).parent().parent().children().eq(3)
                            _num = parseFloat($(__x).text())
                            // _temps+=parseFloat($(x[_i]).text())*_num
                            if ($(x[_i]).text()){
                                _temps+=parseFloat($(x[_i]).text())*_num
                            }
                            else
                                {
                                    _temps+=0.0
                                }
                            if ($(x1[_i]).text())
                                _temps1+=parseFloat($(x1[_i]).text())*_num
                            else
                                _temps1+=0.0
                        }

                    if (!_temps1)
                        _temps1=''
                    _temps = _temps.toString()
                    _temps1 = _temps1.toString()
                    if (_temps.indexOf('.')!=-1)
                        total.push(_temps.substr(0,_temps.indexOf('.')+5))

                    else
                        total.push(_temps)
                    if (_temps1.indexOf('.')!=-1)
                        total1.push(_temps1.substr(0,_temps1.indexOf('.')+5))

                    else
                        total1.push(_temps1)
                }
            else
                {
                    total.push('')
                    total1.push('')
                }
            }        
    _dab.row.add(total).draw()
    _dab.row.add(total1).draw()

    
    console.log(total)


}
// 开标
// $('#materials_Bill,.materials_Bill,.totalPrice_Sort,#totalPrice_Sort').addClass('hidden');

$('#sign-in').click(function(){
    Mr.saveSesstionStorage('is_click_bid','')
    location.reload();
})

$('#kaibiao').click(function(){
    Mr.saveSesstionStorage('is_click_bid','True')
    _kb_click()
    });



// 分页函数
page_fun = function(obj){

    $('.click_page_num').parent().removeClass('active')
    cur_page = $(obj).attr('value')
    _value = 1
    if (cur_page!='next' && cur_page!='prev')
        {
            _value = parseInt($(obj).attr('value'))
            $('.click_page_num[value="'+$(obj).attr('value')+'"]').parent().addClass('active')
        }
    else
        if (cur_page=='next')
            {
                _value = (parseInt(Mr.sstorage['pageno'])+1>parseInt(Mr.sstorage['max_page']))?parseInt(Mr.sstorage['max_page']):parseInt(Mr.sstorage['pageno'])+1
                $('.click_page_num[value="'+_value+'"]').parent().addClass('active')
            }
        else
        {
            _value = (parseInt(Mr.sstorage['pageno'])-1>0)?parseInt(Mr.sstorage['pageno'])-1:1
            $('.click_page_num[value="'+_value+'"]').parent().addClass('active')
        }
    Mr.saveSesstionStorage('pageno',_value)


    parmer = {
    'pageNo':_value,
    'pk':Mr.getParamers()['pk'],
    'AccessToken':Mr.sstorage['AccessToken']
    }
    console.log(parmer)
    Mr.requestData('https://lw.szby.cn/data/bid/openBidData_yb/',parmer,function(res){
        super_list = res['data']['sup_list']    
        
        // 增加排名
        for (var i=0;i<super_list.length;i++){
            super_list[i]['rank'] = ((parseInt(Mr.sstorage['pageno'])?parseInt(Mr.sstorage['pageno']):1)-1)*5+1+i
        }



        Mr.saveSesstionStorage('super_list',JSON.stringify(super_list))
        Mr.saveSesstionStorage('max_page',res['totalPage'])

        var data_sets = res['data']['mat_list']['rows']

        var header = []
        var _head = res['data']['mat_list']['header']
        start_num = _head.indexOf('数量')
        end_num = _head.length
        // for (var key in _head)
        //     if (header[key]['title'].indexOf('数量')!=-1)
        //         {start_num = key;break;}
        __t = parseInt(_value)
        for (var i=0;i<_head.length;i++)
        {
            if (i>start_num)
                header.push({'title':_head[i],'sClass':'unit_price'+(i+__t)+''})
            else
                header.push({'title':_head[i]})
        }



        // 判断最小值
        for(var i=0;i<data_sets.length;i++){
            _data = data_sets[i]
            for (var j=0;j<_data.length;j++)
            {   
                
                m_min = _data[_data.length-1].split('|')
                m_min = parseFloat(m_min[m_min.length-1]) // 最小值

                var _temp = ''
                if (start_num<j&&j<_data.length-1)  //  属于每个品牌字段中
                {
                    m_data = _data[j].split('|')
                    for (var _i=0;_i<m_data.length;_i++)
                        if (m_data[_i]<=m_min)
                        _temp +='<span class="yb_'+_i+'" style="background:green;color:white">'+m_data[_i]+'</span>'+Mr.Nbsp_Number(5)
                        else
                            _temp +='<span class="yb_'+_i+'">'+m_data[_i]+'</span>'+Mr.Nbsp_Number(5)

                    data_sets[i][j] = _temp
                }
            }
        }


        // Mr.saveSesstionStorage('header',JSON.stringify(header))
        // Mr.saveSesstionStorage('data_sets',JSON.stringify(data_sets))
        Mr.saveSesstionStorage('data_sets',JSON.stringify(data_sets))
        $('#totalPrice_Sort').empty()
        $('#materials_Bill').empty()

        $('#totalPriceSort').tmpl(super_list).appendTo('#totalPrice_Sort')  // 一键开标后的表单
        $('#materialsBill').tmpl(head).appendTo('#materials_Bill')          //一键开标后的表单 
        if (Mr.sstorage['ppyq']=='false')
            $('.m_brand_name').addClass('hidden')

        $('.start_yb').click(function(){
            sup_id = $(this).attr('sup_id')
            brand = $(this).attr('brand')
            pk = Mr.getParamers()['pk']
            url = "mat_call_bid.html?pk="+pk+'&brand='+brand+'&sup_id='+sup_id+''
            // Mr.requestData('mat_call_bid.html')
            location.href=(url)
        })
        _dab = jQuery('#materialsBillExample').dataTable( {
                data: data_sets,
                info: false,     //底部信息
                ordering: false,    // 禁止排序
                paging: false,      // 禁止分页

                bFilter: false,     // 禁止搜索
                "sScrollY" : "100%", //DataTables的高  
                    // "sScrollX" : 820, //DataTables的宽  
                bScrollCollapse : false, //是否开启DataTables的高度自适应，当数据条数不够分页数据条数的时候，插件高度是否随数据条数而改变
                "columns": header,

                "lengthMenu": [-1],      //每页显示多少数据
                "lengthChange": false,   //选择每页显示多少条数据，下拉选项       

                zeroRecords: "没有内容",
                "sScrollX": "100%",
                "oLanguage": { //国际化配置  
                        "sProcessing" : "正在获取数据，请稍后...",    
                        "sLengthMenu" : "显示 _MENU_ 条",    
                        "sZeroRecords" : "没有您要搜索的内容",    
                        "sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
                        "sInfoEmpty" : "记录数为0",    
                        "sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
                        "sInfoPostFix" : "",    
                        "sSearch" : "搜索",    
                        "sUrl" : "",    
                        "oPaginate": {    
                            "sFirst" : "第一页",    
                            "sPrevious" : "上一页",    
                            "sNext" : "下一页",    
                            "sLast" : "最后一页"    
                        }  
                    },
                rowCallback:function(){
                    main_table = $('materialsBillExample')
                    var tfoot = document.createElement('tfoot')
                    tfoot.innerHTML = '<td>总合计</td>'
                    main_table.append(tfoot)
                }       
            }) // datatable
    
    _dab = $('#materialsBillExample').DataTable()
    // 合计
    // m_nums =header[key]['title'].indexOf('数量')
    m_nums = 3 // 数量位置  
    total = []
    total1 = []
    total.push('<div class="sum_num">议标前合计</div>')
    total1.push('<div class="sum_num">议标后合计</div>')
    _pageno = parseInt(Mr.sstorage['pageno'])
    for (var i=1;i<end_num;i++){
            if (i>start_num)
                {
                    x = $('.unit_price'+(i+_pageno)+' .yb_0')
                    x1 = $('.unit_price'+(i+_pageno)+' .yb_1')       // 议标后
                    // console.log(x)
                    var _temps = 0
                    var _temps1 = 0
                    for (var _i=0;_i<x.length;_i++)
                        {   
                             __x = $(x[_i]).parent().parent().children().eq(3)
                            _num = parseFloat($(__x).text())
                            // _temps+=parseFloat($(x[_i]).text())*_num
                            if ($(x[_i]).text()){
                                _temps+=parseFloat($(x[_i]).text())*_num
                            }
                            else
                                {
                                    _temps+=0.0
                                }
                            if ($(x1[_i]).text())
                                _temps1+=parseFloat($(x1[_i]).text())*_num
                            else
                                _temps1+=0.0
                        }

                    if (!_temps1)
                        _temps1=''
                    _temps = _temps.toString()
                    _temps1 = _temps1.toString()
                    if (_temps.indexOf('.')!=-1)
                        total.push(_temps.substr(0,_temps.indexOf('.')+5))

                    else
                        total.push(_temps)
                    if (_temps1.indexOf('.')!=-1)
                        total1.push(_temps1.substr(0,_temps1.indexOf('.')+5))

                    else
                        total1.push(_temps1)
                }
            else
                {
                    total.push('')
                    total1.push('')
                }
            }

    _dab.row.add(total).draw()
    _dab.row.add(total1).draw()


    })
}

}); // ready
</script>

<style>
        #example_paginate,#example{text-align: center !important}
        #example tfoot tr th{text-align: center}
        .example thead tr th{background-color: #ddd;padding-top: 20px;text-align: center;padding-bottom: 20px;}
</style>

<style>
.part-table td{text-align: center;border-right:slategray solid;border-bottom:slategray solid;color: black;height: 100%;}
.part-table th{text-align: center;border-right:slategray solid;border-bottom:slategray solid;color: black;background: darkgrey}
.brand{width: 160px;height: 47.4px;background-color: rgba(255, 255, 255, 0) !important;}
.brandDcp{color: white}
</style>
<!-- <link rel="stylesheet" type="text/css" href="michealMedia/css/bootstrap.min.css" /> -->
<script type="text/javascript" src="michealMedia/bootstrap.min.js"></script>  
</body>
</html>